apiVersion: batch/v1
kind: Job
metadata:
  labels:
    app: fmke-client
  name: fmke-client-paravance
spec:
  backoffLimit: 10
  completions: 5
  parallelism: 5
  template:
    metadata:
      labels:
        app: fmke-client
    spec:
      containers:
      - image: ntlinh/fmke_client:latest
        imagePullPolicy: IfNotPresent
        lifecycle:
          postStart:
            exec:
              command:
              - cp
              - /cluster_node/fmke_client_paravance.config
              - /fmke_client/fmke_client.config
        name: fmke-client
        volumeMounts:
        - mountPath: /cluster_node/
          name: cluster-node
        - mountPath: /results/
          name: cluster-node-results
      nodeSelector:
        cluster_g5k: paravance
        service_g5k: fmke_client
      restartPolicy: Never
      terminationGracePeriodSeconds: 10
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app: fmke-client
        maxSkew: 1
        topologyKey: kubernetes.io/hostname
        whenUnsatisfiable: DoNotSchedule
      volumes:
      - hostPath:
          path: /tmp/fmke_client
        name: cluster-node
      - hostPath:
          path: /tmp/results
        name: cluster-node-results
  ttlSecondsAfterFinished: 5
